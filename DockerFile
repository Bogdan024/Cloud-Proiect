# Dockerfile
# A simpler approach for dynamic Next.js with API routes

FROM node:18-alpine AS base
WORKDIR /app

# Install dependencies
COPY package.json yarn.lock .
RUN yarn install --frozen-lockfile

# Copy rest of source
COPY . .

# Build Next.js app
RUN yarn build

# Production image
FROM node:18-alpine AS runner
WORKDIR /app

# Copy only what's needed
COPY package.json yarn.lock .
RUN yarn install --production --frozen-lockfile

COPY .next .next
COPY public public

# Set environment
ENV NODE_ENV=production
ENV PORT=3000

EXPOSE 3000

CMD ["yarn", "start"]
